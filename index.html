<html>
  <head>
    <title>RemixWorld 3rd-party Uploader</title>

    <script type="text/javascript" src="http://video.remix.local/javascripts/jquery.js"></script> 
    <script type="text/javascript" src="http://video.remix.local/javascripts/jquery.ba-postmessage.js"></script> 
    <script type="text/javascript" src="http://video.remix.local/javascripts/videoupload.js"></script>
    
    <script type="text/javascript">
    
      $(document).ready(function(){
        $.ajax({
          url: "http://rw.remix.local/oauth/elijah.local/check_login.js",
          dataType: "jsonp",
          cache: false,
          success: function(data){
            console.log(data);
            if(data['logged_in'] != true){
              window.location.href = data['login_path'];
            }
          }
        });
        
        var action = $("form#video_upload_form").attr("action");
        $("form#video_upload_form").submit(function(e){
          Remix.Video.upload({
            form: this, 
            destination: "http://video.remix.local/proxy.html",
            respondToDestination: "http://elijah.local/proxy.html",
            respondToTarget: "top",
            start: function(data){
              console.log("starting");
              console.log(data);
            },
            progress: function(data){
              console.log("progress");
              console.log(data);
            },
            error: function(data){
              console.log("error");
              console.log(data);
            },
            success: function(data){
              // TODO: have Remix.Video add a hidden field for video_file_id
              console.log("success");
              console.log(data);
            }
          });
          return true;
        });
      })
    </script>
  </head>
  <body>
    <a href="http://rw.remix.local/oauth/elijah.local/logout">Logout</a>
    
    <h1>Upload a video to RemixWorld<br />Example App</h1>

    <p style="color:red">To get this running, see <a href="INSTALL.markdown">Setup Instructions</a></p>

    Upload a file to video.remix.local:<br />

    <div style="float:left">
      <p>RW Video Upload</p>
      <iframe name="rw_video_upload"></iframe>
    </div>

    <p>Progress Bar</p>
    
    <iframe id="rw_progress" name="rw_progress" src="http://video.remix.local/track_upload_progress.html?_=12422242312439"></iframe>
    
    <h2>Video Upload Form</h2>
    <div id="error_message" style="color:red"></div>
    
    <form id="video_upload_form" action="http://video.remix.local/api/videos" target="rw_video_upload" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="destination"/>
      <input type="hidden" name="target"/>
      <input type="file" name="file" />
      <input type="submit" />
    </form>

    <h2>Metadata Upload Form</h2>
    <form id="metadata_form" action="/api/v1/videos.json" method="POST">
      <label>Uploaded File ID: <input id="video_file_id" type="text" name="video[video_file_id]" style="width:23em" /> (normally this would be hidden)</label><br />
      <label>Title: <input type="text" name="video[title]" /></label><br />
      <label>Description: <input name="video[description]" /></label><br />
      <label>Tags: <input type="text" name="video[tag_list]" /></label><br />
      <input id="create_button" type="submit" value="Create Video" disabled="true" />
    </form>

    <br />
    <hr />
    <p><a href="/api.textile">RemixWorld Video Upload API</a></p>
  </body>
</html>
